<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <!--
        Invoices
        -->
        <record id="view_invoice_line_tree_product_uos_extended" model="ir.ui.view">
            <field name="name">account.invoice.line.tree.product.uos.extended</field>
            <field name="model">account.invoice.line</field>
            <field name="type">tree</field>
            <field name="inherit_id" ref="account.view_invoice_line_tree"/>
            <field name="arch" type="xml">
                <data>
                    <field name="account_id" groups="account.group_account_user" position="after">
                        <field name="quantity_uom" groups="product.group_uos" string="Quantity(UoM)" />
                        <field name="uom_id" groups="product.group_uos" string="(UoM)"/>
                        <field name="price_unit_uom" groups="product.group_uos" string="Price(UoM)" />
                    </field>
                </data>
            </field>
        </record>

        <record id="view_invoice_line_form_product_uos_extended" model="ir.ui.view">
            <field name="name">account.invoice.line.form.product.uos.extended</field>
            <field name="model">account.invoice.line</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="account.view_invoice_line_form"/>
            <field name="arch" type="xml">
                <data>
                    
                    <!-- Modify existing ones -->
                    <xpath expr="//form//field[@name='product_id']" position="replace">
                    	<field name="product_id"
                    	       on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.address_invoice_id, parent.currency_id, context, parent.company_id, uom_id, quantity_uom, price_unit_uom)"/>
                    		   <!-- on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.address_invoice_id, parent.currency_id, context, parent.company_id)"/>
                    		   -->
                    </xpath>
                    
                    <xpath expr="//form//label[@string='Quantity :']" position="replace">
                    	<newline/>
                    	<label string="Quantity :" align="1.0" 
                    		   attrs="{'readonly':True, 'invisible':[('product_has_uos','=',False)]}" />
                    </xpath>
                    <xpath expr="//form//group" position="replace">
                    	<group colspan="1" col="2" attrs="{'invisible':[('product_has_uos','=',False)]}">
	                    	<field name="quantity" 
	                               nolabel="1" 
	                               groups="product.group_uos" 
	                               attrs="{'invisible':[('product_has_uos','=',False)]}" 
	                               on_change="onchange_quantity(product_id, quantity_uom, uom_id, price_unit_uom, quantity, uos_id, price_unit, parent.currency_id, product_has_uos, cancel_uom, cancel_uom_qty, cancel_uom_price, cancel_uos, cancel_uos_qty, cancel_uos_price, context)" 
	                               help="This is the price per unit of sale (or secondary unit of measure)"/>
                            <field name="uos_id" 
	                               nolabel="1"
	                               groups="product.group_uos" 
	                               attrs="{'invisible':[('product_has_uos','=',False)]}" 
	                               on_change="onchange_uos_id(product_id, quantity_uom, uom_id, price_unit_uom, quantity, uos_id, price_unit, name, parent.type, parent.partner_id, parent.fiscal_position, parent.address_invoice_id, parent.currency_id, product_has_uos, cancel_uom, cancel_uom_qty, cancel_uom_price, cancel_uos, cancel_uos_qty, cancel_uos_price, context, parent.company_id)"
	                               domain="[]"/>
                    	</group>
                    </xpath>
                    <xpath expr="//form//field[@name='price_unit']" position="replace">
                        <field name="price_unit" 
                               groups="product.group_uos" 
                               attrs="{'invisible':[('product_has_uos','=',False)]}" 
                               on_change="onchange_price_unit(product_id, quantity_uom, uom_id, price_unit_uom, quantity, uos_id, price_unit, parent.currency_id, product_has_uos, cancel_uom, cancel_uom_qty, cancel_uom_price, cancel_uos, cancel_uos_qty, cancel_uos_price, context)"/>
                    
                    	<newline/>
                   	</xpath>
                    
                    
                    <xpath expr="//form//field[@name='price_unit']" position="after">
                    	<newline/>
                    	<label string="Quantity :" align="1.0" 
                    		   attrs="{'readonly':True, 'invisible':[('product_has_uos','=',True)]}" />
                    	<!-- Dummy fields -->
                        <group colspan="1" col="2" attrs="{'invisible':[('product_has_uos','=',True)]}">
                            <field name="quantity_dummy" 
                                   nolabel="1" 
                                   groups="product.group_uos" 
                                   attrs="{'readonly':True, 'invisible':[('product_has_uos','=',True)]}" />
                            <field name="uos_id_dummy" 
                                   nolabel="1" 
                                   groups="product.group_uos" 
                                   attrs="{'readonly':True, 'invisible':[('product_has_uos','=',True)]}" />
                        </group>
                        <field name="price_unit_dummy" 
                               groups="product.group_uos" 
                               attrs="{'readonly':True, 'invisible':[('product_has_uos','=',True)]}"
                               help="This is the price per unit of sale (or secondary unit of measure)" />
                    	<newline/>
                   	</xpath>
                    <xpath expr="//form//field[@name='account_id']" position="before">
                    	<newline/>
                        <field name="product_has_uos" 
                        	   colspan="2" 
                               groups="product.group_uos" 
                               attrs="{'invisible': True}"/>
                    	<newline/>
                        <field name="cancel_uom" attrs="{'invisible': True}"/>
                    	<newline/>
                        <field name="cancel_uom_qty" attrs="{'invisible': True}"/>
                    	<newline/>
                        <field name="cancel_uom_price" attrs="{'invisible': True}"/>
                    	<newline/>
                        <field name="cancel_uos" attrs="{'invisible': True}"/>
                    	<newline/>
                        <field name="cancel_uos_qty" attrs="{'invisible': True}"/>
                    	<newline/>
                        <field name="cancel_uos_price" attrs="{'invisible': True}"/>
                   	</xpath>
                    
                    <!-- Add new ones -->
                    <xpath expr="//form//field[@name='name']" position="after">
                    	<newline/>
                        <label string="Quantity(UoM) :" align="1.0"/>
                        <group colspan="1" col="2">
                            <field name="quantity_uom" 
                                   nolabel="1" 
                                   groups="product.group_uos" 
                                   on_change="onchange_quantity_uom(product_id, quantity_uom, uom_id, price_unit_uom, quantity, uos_id, price_unit, parent.type, parent.partner_id, parent.currency_id, product_has_uos, cancel_uom, cancel_uom_qty, cancel_uom_price, cancel_uos, cancel_uos_qty, cancel_uos_price, context)"/>
                            <field name="uom_id" 
                                   nolabel="1" 
                                   groups="product.group_uos" 
                                   on_change="onchange_uom_id(product_id, quantity_uom, uom_id, price_unit_uom, quantity, uos_id, price_unit, parent.currency_id, product_has_uos, cancel_uom, cancel_uom_qty, cancel_uom_price, cancel_uos, cancel_uos_qty, cancel_uos_price, context)"/>
                        </group>
                        <field name="price_unit_uom" 
                               groups="product.group_uos" 
                               on_change="onchange_price_unit_uom(product_id, quantity_uom, uom_id, price_unit_uom, quantity, uos_id, price_unit, parent.currency_id, product_has_uos, cancel_uom, cancel_uom_qty, cancel_uom_price, cancel_uos, cancel_uos_qty, cancel_uos_price, context)" 
                               help="This is the price per unit of measure (or warehouse/logistic unit of measure)"/>
                    	<newline/>
                    </xpath>
                </data>
            </field>
        </record>


    </data>
</openerp>